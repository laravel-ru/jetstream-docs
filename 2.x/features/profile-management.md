# Управление профилем

[[toc]]

## Введение

Доступ к функциям управления профилями Laravel Jetstream осуществляется пользователем с помощью раскрывающегося меню навигации профиля пользователя в правом верхнем углу. Jetstream формирует представления и действия, которые позволяют пользователю обновлять свое имя, адрес электронной почты и, при необходимости, фотографию своего профиля.

![Скриншот управления профилем](./../../assets/img/profile-management.png)

## Действия

Как типично для большинства функций Jetstream, логику, выполняемую для удовлетворения запросов на обновление профиля, можно найти в классе действий в Вашем приложении. В частности, класс `App\Actions\Fortify\UpdateUserProfileInformation` будет вызываться, когда пользователь обновляет свой профиль. Это действие отвечает за проверку ввода и обновление информации профиля пользователя.

Следовательно, любые настройки, которые Вы хотите внести в управление этой информацией в Вашем приложении, должны выполняться в этом классе. При вызове действие получает аутентифицированного в данный момент пользователя `$user` и массив `$input`, который содержит все данные входящего запроса, включая обновленную фотографию профиля, если применимо.

:::tip Управление дополнительной информацией

Если Вам необходимо управлять дополнительной информацией о пользователе, не чувствуйте себя обязанным добавлять дополнительную информацию в карточку «Информация профиля» в пользовательском интерфейсе Вашего приложения Jetstream. Вы можете добавлять дополнительные элементы пользовательского интерфейса и формы на панель инструментов профиля пользователя, относящиеся к информации, которой Вы хотите управлять.
:::

## Представления / Страницы

При использовании стека Livewire форма информации профиля пользователя отображается с использованием шаблона Blade `resources/views/profile/update-profile-information-form.blade.php`. При использовании стека Inertia это представление отображается с использованием шаблона `resources/js/Pages/Profile/UpdateProfileInformationForm.vue`.

Каждый из этих шаблонов получит весь объект аутентифицированного пользователя, так что Вы можете добавить дополнительные поля в эти формы по мере необходимости. Любые дополнительные входные данные, добавленные в формы, будут включены в массив `$input`, который передается Вашему действию `UpdateUserProfileInformation`.

## Фото профиля

### Включение фото профиля

Если Вы хотите разрешить пользователям загружать пользовательские фотографии профиля, Вы должны включить эту функцию в файле конфигурации Вашего приложения `config/jetstream.php`. Чтобы включить эту функцию, просто раскомментируйте соответствующую запись функции из элемента конфигурации `features` в этом файле:

```php
use Laravel\Jetstream\Features;

'features' => [
    Features::profilePhotos(),
    Features::api(),
    Features::teams(),
],
```

После включения функции фото профиля Вы должны выполнить Artisan-команду `storage:link`. Эта команда создаст символическую ссылку в каталоге `public` Вашего приложения, которая позволит Вашему приложению обслуживать изображения Ваших пользователей. Для получения информации об этой команде обратитесь к [документации по файловой системе Laravel](https://getlaravel.ru/docs/filesystem#the-public-disk):

```bash
php artisan storage:link
```

### Управление фотографиями профиля

Функциональность фотографии профиля Jetstream поддерживается трейтом `Laravel\Jetstream\HasProfilePhoto`, который автоматически присоединяется к Вашему классу `App\Models\User` во время установки Jetstream.

Этот трейт содержит такие методы, как `updateProfilePhoto`, `getProfilePhotoUrlAttribute`, `defaultProfilePhotoUrl` и `profilePhotoDisk`, которые могут быть перезаписаны Вашим собственным классом `App\Models\User`, если Вам нужно настроить их поведение. Вам предлагается прочитать исходный код этого трейта, чтобы получить полное представление о функциях, которые он предоставляет Вашему приложению.

Метод `updateProfilePhoto` является основным методом, используемым для хранения фотографий профиля, и вызывается классом действия Вашего приложения `App\Actions\Fortify\UpdateUserProfileInformation`.

:::tip Laravel Vapor

По умолчанию диск `s3` будет использоваться для хранения фотографий профиля, когда Ваше приложение Jetstream работает в [Laravel Vapor](https://vapor.laravel.com).
:::

## Удаление аккаунта

Экран управления профилем также включает панель действий, которая позволяет пользователю удалить свою учетную запись приложения. Когда пользователь решает удалить свою учетную запись, будет вызван класс действия `App\Actions\Jetstream\DeleteUser`. Вы можете настроить логику удаления учетной записи в этом классе.

Функцию удаления учетной записи можно отключить, удалив ее из конфигурационного файла Вашего приложения `config/jetstream.php`:

```php
use Laravel\Jetstream\Features;

'features' => [
    Features::termsAndPrivacyPolicy(),
    Features::profilePhotos(),
    Features::api(),
    Features::teams(),
    // Features::accountDeletion(),
],
```
