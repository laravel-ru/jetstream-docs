(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{318:function(t,s,a){t.exports=a.p+"assets/img/api.9a433930.png"},365:function(t,s,a){"use strict";a.r(s);var e=a(40),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#api"}},[t._v("#")]),t._v(" API")]),t._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#вступление"}},[t._v("Вступление")])]),e("li",[e("a",{attrs:{href:"#включение-поддержки-api"}},[t._v("Включение поддержки API")])]),e("li",[e("a",{attrs:{href:"#определение-разрешении"}},[t._v("Определение разрешений")])]),e("li",[e("a",{attrs:{href:"#авторизация-входящих-запросов"}},[t._v("Авторизация входящих запросов")]),e("ul",[e("li",[e("a",{attrs:{href:"#запросы-инициированные-пользовательским-интерфеисом"}},[t._v("Запросы, инициированные пользовательским интерфейсом")])])])])])]),e("p"),t._v(" "),e("h2",{attrs:{id:"вступление"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#вступление"}},[t._v("#")]),t._v(" Вступление")]),t._v(" "),e("p",[t._v("Jetstream включает встроенную интеграцию с "),e("a",{attrs:{href:"https://getlaravel.ru/docs/sanctum",target:"_blank",rel:"noopener noreferrer"}},[t._v("Laravel Sanctum"),e("OutboundLink")],1),t._v(". Laravel Sanctum предоставляет легкую систему аутентификации для SPA (одностраничных приложений), мобильных приложений и простых API на основе токенов. Sanctum позволяет каждому пользователю Вашего приложения создавать несколько токенов API для своей учетной записи. Этим токенам могут быть предоставлены возможности / разрешения, которые определяют, какие действия токенам разрешено выполнять.")]),t._v(" "),e("p",[e("img",{attrs:{src:a(318),alt:"Скриншот Laravel Jetstream API"}})]),t._v(" "),e("p",[t._v("По умолчанию к панели создания токенов API можно получить доступ, используя ссылку «API» в раскрывающемся меню профиля пользователя в правом верхнем углу. На этом экране пользователи могут создавать токены Sanctum API с различными разрешениями.")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("Документация Sanctum")]),t._v(" "),e("p",[t._v("Для получения дополнительной информации о Sanctum и о том, как отправлять запросы к API с аутентификацией Sanctum, обратитесь к официальной "),e("a",{attrs:{href:"https://getlaravel.ru/docs/sanctum",target:"_blank",rel:"noopener noreferrer"}},[t._v("документации Sanctum"),e("OutboundLink")],1),t._v(".")])]),t._v(" "),e("h2",{attrs:{id:"включение-поддержки-api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#включение-поддержки-api"}},[t._v("#")]),t._v(" Включение поддержки API")]),t._v(" "),e("p",[t._v("Если Ваше приложение будет предлагать API, который может использоваться третьими сторонами, Вы должны включить функцию API Jetstream. Для этого Вы должны раскомментировать соответствующую запись в опции конфигурации "),e("code",[t._v("features")]),t._v(" конфигурационного файла Вашего приложения "),e("code",[t._v("config/jetstream.php")]),t._v(":")]),t._v(" "),e("div",{staticClass:"language-php extra-class"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[e("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'features'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    Features"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("profilePhotos")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    Features"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("api")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    Features"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("teams")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),e("h2",{attrs:{id:"определение-разрешении"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#определение-разрешении"}},[t._v("#")]),t._v(" Определение разрешений")]),t._v(" "),e("p",[t._v("Разрешения, доступные для токенов API, определяются с помощью метода "),e("code",[t._v("Jetstream::permissions")]),t._v(" в классе "),e("code",[t._v("App\\Providers\\JetstreamServiceProvider")]),t._v(" Вашего приложения. Разрешения определяются как простые строки. Как только они будут определены, они могут быть назначены токену API:")]),t._v(" "),e("div",{staticClass:"language-php extra-class"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[t._v("Jetstream"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("defaultApiTokenPermissions")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'read'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nJetstream"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("permissions")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'post:create'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'post:read'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'post:update'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'post:delete'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("Метод "),e("code",[t._v("defaultApiTokenPermissions")]),t._v(" в приведенном выше примере может использоваться для указания, какие разрешения должны быть выбраны по умолчанию при создании нового токена API. Конечно, пользователь может снять отметку с разрешения по умолчанию перед созданием токена.")]),t._v(" "),e("h2",{attrs:{id:"авторизация-входящих-запросов"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#авторизация-входящих-запросов"}},[t._v("#")]),t._v(" Авторизация входящих запросов")]),t._v(" "),e("p",[t._v("Каждый запрос, сделанный к Вашему приложению Jetstream, даже к аутентифицированным маршрутам в Вашем файле "),e("code",[t._v("routes/web.php")]),t._v(", будет связан с объектом токена Sanctum. Вы можете определить, имеет ли связанный токен данное разрешение, используя метод "),e("code",[t._v("tokenCan")]),t._v(", предоставляемый трейтом "),e("code",[t._v("Laravel\\Sanctum\\HasApiTokens")]),t._v(".")]),t._v(" "),e("p",[t._v("Эта характеристика "),e("code",[t._v("HasApiTokens")]),t._v(" автоматически применяется к модели Вашего приложения "),e("code",[t._v("App\\Models\\User")]),t._v(" во время установки Jetstream. Обычно Вы вызываете метод "),e("code",[t._v("tokenCan")]),t._v(" в контроллерах Вашего приложения, компонентах Livewire или "),e("a",{attrs:{href:"https://getlaravel.ru/docs/authorization#creating-policies",target:"_blank",rel:"noopener noreferrer"}},[t._v("политиках авторизации"),e("OutboundLink")],1),t._v(":")]),t._v(" "),e("div",{staticClass:"language-php extra-class"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("user")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("id")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$post")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("user_id")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n       "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("user")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("tokenCan")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'post:update'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h3",{attrs:{id:"запросы-инициированные-пользовательским-интерфеисом"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#запросы-инициированные-пользовательским-интерфеисом"}},[t._v("#")]),t._v(" Запросы, инициированные пользовательским интерфейсом")]),t._v(" "),e("p",[t._v("Когда пользователь делает запрос к маршруту в Вашем файле "),e("code",[t._v("routes/web.php")]),t._v(", запрос обычно аутентифицируется Sanctum через аутентифицированную защиту на основе cookie сеанса. В большинстве приложений Laravel это защита сети "),e("code",[t._v("web")]),t._v(".")]),t._v(" "),e("p",[t._v("Когда пользователь делает первичный запрос через пользовательский интерфейс приложения, метод "),e("code",[t._v("tokenCan")]),t._v(" всегда будет возвращать "),e("code",[t._v("true")]),t._v(". Помните, это не обязательно означает, что Ваше приложение должно позволять пользователю выполнять действие. Как правило, Ваши политики определяют, предоставлено ли токену разрешение на выполнение возможностей, "),e("strong",[t._v("а также проверяют, разрешено ли самому экземпляру пользователя выполнять действие")]),t._v(".")]),t._v(" "),e("p",[t._v("Например, в случае обновления сообщения в блоге это может означать проверку того, что токен авторизован для обновления сообщений "),e("strong",[t._v("и")]),t._v(" что сообщение принадлежит пользователю:")]),t._v(" "),e("div",{staticClass:"language-php extra-class"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("user")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("id")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$post")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("user_id")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n       "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("user")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("tokenCan")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'post:update'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[t._v("Сначала может показаться странным разрешение вызова метода "),e("code",[t._v("tokenCan")]),t._v(" и всегда возвращать "),e("code",[t._v("true")]),t._v(" для запросов, инициированных пользовательским интерфейсом; однако удобно всегда предполагать, что токен API доступен и может быть проверен с помощью метода "),e("code",[t._v("tokenCan")]),t._v(". Это означает, что Вы всегда можете вызвать метод "),e("code",[t._v("tokenCan")]),t._v(" в рамках политик авторизации Вашего приложения, не беспокоясь о том, был ли запрос инициирован из пользовательского интерфейса Вашего приложения или был инициирован одним из сторонних потребителей Вашего API.")])])}),[],!1,null,null,null);s.default=n.exports}}]);