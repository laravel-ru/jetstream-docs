## Примеры форматирования

::: tip Знаете ли Вы, что?
Laravel теперь предлагает Horizon, красивую панель управления и систему конфигурации для ваших очередей с поддержкой Redis. Ознакомьтесь с полной [документацией Horizon](/docs/{{version}}/horizon) для дополнительной информации.
:::

::: warning Что-то, что нужно помнить
Laravel теперь предлагает Horizon, красивую панель управления и систему конфигурации для ваших очередей с поддержкой Redis. Ознакомьтесь с полной [документацией Horizon](/docs/{{version}}/horizon) для дополнительной информации.
:::

::: danger Будьте осторожны!
Laravel теперь предлагает Horizon, красивую панель управления и систему конфигурации для ваших очередей с поддержкой Redis. Ознакомьтесь с полной [документацией Horizon](/docs/{{version}}/horizon) для дополнительной информации.
:::

Очереди Laravel предоставляют унифицированный API для множества различных очередей, таких как Beanstalk, Amazon SQS, Redis или даже для реляционной базы данных. Очереди позволяют отложить обработку трудоемкой задачи, такой как отправка электронного письма, на более позднее время. Откладывание этих трудоемких задач резко ускоряет веб-запросы к Вашему приложению.

Файл конфигурации очереди хранится в `config/queue.php`. В этом файле вы найдете конфигурации подключения для каждого из драйверов очереди, включенных в структуру, которая включает базу данных, [Beanstalkd](https://kr.github.io/beanstalkd/), [Amazon SQS](https://aws.amazon.com/sqs/), [Redis](https://redis.io) и синхронный драйвер, который немедленно выполняет задания (для локального использования). Также включен драйвер очереди `null`, который отбрасывает задания в очереди.

### Подраздел

Прежде чем приступить к работе с очередями Laravel, важно понять различие между «connections» и «queues». В Вашем конфигурационном файле `config/queue.php` есть опция конфигурации `connections`. Этот параметр определяет конкретное соединение с серверной службой, такой как Amazon SQS, Beanstalk или Redis. Однако любое данное соединение очереди может иметь несколько «queues», которые могут рассматриваться как различные стеки или груды поставленных в очередь заданий.

Обратите внимание, что каждый пример конфигурации соединения в файле конфигурации `queue` содержит атрибут `queue`. Это очередь по умолчанию, в которую будут отправляться задания при их отправке в определенное соединение. Другими словами, если Вы отправляете задание без явного определения очереди, в которую оно должно быть отправлено, задание будет помещено в очередь, которая определена в атрибуте `queue` конфигурации соединения:

```php
// Это задание отправляется в очередь по умолчанию...
Job::dispatch();

// Это задание отправлено в очередь "электронных писем"...
Job::dispatch()->onQueue('emails');
```

#### 4-й уровень

Чтобы использовать драйвер очереди `database`, Вам понадобится таблица базы данных для хранения заданий. Чтобы сгенерировать миграцию, которая создает эту таблицу, запустите Artisan-команду `queue:table`. После того, как миграция будет создана, Вы можете перенести свою базу данных с помощью команды `migrate`:

```bash
php artisan queue:table

php artisan migrate
```

```php
<?php

namespace App\Providers;

use Illuminate\Support\Facades\Queue;
use Illuminate\Support\ServiceProvider;
use Illuminate\Queue\Events\JobProcessed;
use Illuminate\Queue\Events\JobProcessing;

class AppServiceProvider extends ServiceProvider
{
    /**
     * Bootstrap any application services.
     *
     * @return void
     */
    public function boot()
    {
        Queue::before(function (JobProcessing $event) {
            // $event->connectionName
            // $event->job
            // $event->job->payload()
        });

        Queue::after(function (JobProcessed $event) {
            // $event->connectionName
            // $event->job
            // $event->job->payload()
        });
    }

    /**
     * Register the service provider.
     *
     * @return void
     */
    public function register()
    {
        //
    }
}
```
