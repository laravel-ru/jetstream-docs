# Регистрация

[[toc]]

## Введение

Конечно, прежде чем кто-либо сможет использовать Ваше приложение, им необходимо создать учетную запись. К счастью, Jetstream предоставляет представление регистрации и соответствующее действие, которое обрабатывает регистрацию пользователей, так что Вы можете сосредоточиться на создании своего приложения.

![Скриншот аутентификации](./../../assets/img/authentication.png)

## Действия

Как типично для большинства функций Jetstream, логику, выполняемую для удовлетворения запросов на регистрацию, можно найти в классе действий в Вашем приложении. Помните, что действия - это гранулярные классы, которые отвечают за выполнение одной задачи, связанной с функцией Jetstream или Fortify.

В частности, класс `App\Actions\Fortify\CreateNewUser` будет вызываться, когда пользователь регистрируется в Вашем приложении. Это действие отвечает за проверку ввода входящего запроса и создание пользователя. Следовательно, любые настройки, которые Вы хотите внести в логику создания пользователей, должны выполняться в этом классе. Действие получает массив `$input`, который содержит все входные данные входящего запроса.

### Правила проверки пароля

Действия `App\Actions\Fortify\CreateNewUser`, `App\Actions\Fortify\ResetUserPassword` и `App\Actions\Fortify\UpdateUserPassword` используют трейт `App\Actions\Fortify\PasswordValidationRules`.

Как вы могли заметить, трейт `App\Actions\Fortify\PasswordValidationRules` использует настраиваемый объект правила проверки `Laravel\Fortify\Rules\Password`. Этот объект позволяет Вам легко настроить требования к паролю для Вашего приложения. По умолчанию для правила требуется пароль длиной не менее восьми символов. Однако Вы можете использовать следующие методы для настройки требований к паролю:

```php
use Laravel\Fortify\Rules\Password;

// Требуется не менее 10 символов...
(new Password)->length(10)

// Требуется хотя бы один символ верхнего регистра...
(new Password)->requireUppercase()

// Требуется хотя бы один числовой символ...
(new Password)->requireNumeric()

// Требуется хотя бы один специальный символ...
(new Password)->requireSpecialCharacter()
```

Конечно, эти методы можно объединить в цепочку, чтобы определить правила проверки пароля для Вашего приложения:

```php
(new Password)->length(10)->requireSpecialCharacter()
```

## Представления / Страницы

При использовании стека Livewire представление регистрации отображается с использованием шаблона Blade `resources/views/auth/register.blade.php`. При использовании стека инерции это представление отображается с использованием шаблона `resources/js/Pages/Auth/Register.vue`. Любые дополнительные поля, которые Вы добавляете на эти страницы, будут доступны через массив `$input`, переданный в действие `App\Actions\Fortify\CreateNewUser`.

### Настройка представления регистрации

Laravel Jetstream автоматически отобразит соответствующие представления для экрана регистрации Вашего приложения. Однако иногда Вам может потребоваться настроить способ отображения представления / страницы.

Вся логика визуализации представления аутентификации Fortify может быть настроена с помощью соответствующих методов, доступных через класс `Laravel\Fortify\Fortify`. Как правило, этот метод следует вызывать из метода `boot` класса `App\Providers\JetstreamServiceProvider`:

```php
use Laravel\Fortify\Fortify;

/**
 * Загрузка любых служб приложений.
 *
 * @return void
 */
public function boot()
{
    Fortify::registerView(function () {
        return view('auth.register');
    });
}
```

#### Настройка представлений регистрации инерции

Если Ваше приложение использует стек Inertia, Вы можете вернуть страницы Inertia из Ваших замыканий настройки представления:

```php
use Illuminate\Support\Facades\Route;
use Inertia\Inertia;
use Laravel\Fortify\Fortify;

Fortify::registerView(function () {
    return Inertia::render('Auth/Register');
});
```

## Требуется утверждение условий обслуживания / политики конфиденциальности

Многие приложения требуют, чтобы пользователи приняли их условия обслуживания / политику конфиденциальности во время регистрации. Jetstream позволяет легко включить это требование для Вашего собственного приложения, а также предоставляет удобный способ написания этих документов с помощью Markdown.

Для начала включите эту функцию в файле конфигурации Вашего приложения `config/jetstream.php`:

```php
use Laravel\Fortify\Features;

'features' => [
    Features::termsAndPrivacyPolicy(),
    // Features::profilePhotos(),
    // Features::api(),
    // Features::teams(),
    Features::accountDeletion(),
],
```

Затем Вы можете написать свои условия обслуживания / документы о политике конфиденциальности, изменив файлы Вашего приложения `resources/markdown/terms.md` и `resources/markdown/policy.md`.

Во время регистрации Jetstream автоматически попросит пользователя утвердить эти документы. Когда пользователь щелкает ссылку для просмотра документов, Jetstream будет использовать [плагин типографики Tailwind](https://tailwindcss.su/docs/typography-plugin) для преобразования Markdown в красиво отформатированную прозу.

## Подтверждение адреса электронной почты

Laravel Jetstream включает поддержку, требующую, чтобы недавно зарегистрированный пользователь подтвердил свой адрес электронной почты. Однако по умолчанию поддержка этой функции отключена. Чтобы включить эту функцию, Вы должны раскомментировать соответствующую запись в элементе конфигурации `features` конфигурационного файла Вашего приложения `config/fortify.php`:

```php
use Laravel\Fortify\Features;

'features' => [
    Features::registration(),
    Features::resetPasswords(),
    Features::emailVerification(),
    Features::updateProfileInformation(),
    Features::updatePasswords(),
    Features::twoFactorAuthentication(),
],
```

Затем вы должны убедиться, что ваш класс `App\Models\User` реализует интерфейс `Illuminate\Contracts\Auth\MustVerifyEmail`. Этот интерфейс уже импортирован в эту модель для вас.

После завершения этих двух шагов настройки вновь зарегистрированные пользователи получат электронное письмо с предложением подтвердить право собственности на свой адрес электронной почты.

:::tip Laravel Mail

Перед использованием функции сброса пароля Вы должны убедиться, что Ваше приложение Laravel настроено на [отправку электронных писем](https://getlaravel.ru/docs/mail). В противном случае Laravel не сможет отправлять ссылки для подтверждения по электронной почте пользователям Вашего приложения.
:::
