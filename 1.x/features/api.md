# API

[[toc]]

## Вступление

Jetstream включает встроенную интеграцию с [Laravel Sanctum](https://laravel.com/docs/sanctum). Laravel Sanctum предоставляет легкую систему аутентификации для SPA (одностраничных приложений), мобильных приложений и простых API на основе токенов. Sanctum позволяет каждому пользователю Вашего приложения создавать несколько токенов API для своей учетной записи. Этим токенам могут быть предоставлены возможности / разрешения, которые определяют, какие действия токенам разрешено выполнять.

![Скриншот Laravel Jetstream API](./../../assets/img/api.png)

По умолчанию к панели создания токенов API можно получить доступ, используя ссылку «API» в раскрывающемся меню профиля пользователя в правом верхнем углу. На этом экране пользователи могут создавать токены Sanctum API с различными разрешениями.

:::tip Документация Sanctum

Для получения дополнительной информации о Sanctum и о том, как отправлять запросы к API с аутентификацией Sanctum, обратитесь к официальной [документации Sanctum](https://laravel.com/docs/sanctum).
:::

## Включение поддержки API

Если Ваше приложение будет предлагать API третьим лицам, Вы должны включить функцию API Jetstream. Для этого раскомментируйте соответствующую запись в опции конфигурации `features` конфигурационного файла `config/jetstream.php`:

```php
'features' => [
    Features::profilePhotos(),
    Features::api(),
    Features::teams(),
],
```

## Определение разрешений

Разрешения, доступные для токенов API, определяются с помощью метода `Jetstream::permissions` в объекте `JetstreamServiceProvider` Вашего приложения. Разрешения - это простые строки. Как только они будут определены, они могут быть назначены токену API:

```php
Jetstream::defaultApiTokenPermissions(['read']);

Jetstream::permissions([
    'create',
    'read',
    'update',
    'delete',
]);
```

Метод `defaultApiTokenPermissions` может использоваться для указания, какие разрешения должны быть выбраны по умолчанию при создании нового токена API. Конечно, пользователь может снять отметку с разрешения по умолчанию перед созданием токена.

## Авторизация входящих запросов

Каждый запрос, сделанный к Вашему приложению Jetstream, даже к аутентифицированным маршрутам в Вашем файле `routes/web.php`, будет связан с объектом токена Sanctum. Вы можете определить, имеет ли связанный токен данное разрешение, используя метод `tokenCan`, предоставляемый трейтом `Laravel\Sanctum\HasApiTokens`. Этот трейт автоматически применяется к модели Вашего приложения `App\Models\User` во время установки Jetstream:

```php
$request->user()->tokenCan('read');
```

#### Запросы, инициированные пользовательским интерфейсом

Когда пользователь делает запрос к маршруту в вашем файле `routes/web.php`, запрос обычно аутентифицируется Sanctum с помощью веб-защиты `web` на основе файлов куки. Так как в этом сценарии пользователь выполняет первичный запрос через пользовательский интерфейс приложения, метод `tokenCan` всегда будет возвращать `true`.

Поначалу такое поведение может показаться странным; однако удобно всегда предполагать, что токен API доступен и может быть проверен с помощью метода `tokenCan`. Это означает, что в рамках политик авторизации Вашего приложения Вы всегда можете вызвать этот метод, не опасаясь, что с запросом не связан токен.
